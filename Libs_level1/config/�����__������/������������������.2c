//*******************************************************************
//Определения для режима конифгурирования
//*******************************************************************

//Контанты для метода УстановитьТипОбъекта (4-й параметр) - объект дерево
//При строковом выражении - задается имя исполняемой функции
//При задании числового выражения тип объекта определяется:
#Задать	ТипОбъектаТекст		0
#Задать ТипОбъектаАтрибут	1
#Задать ТипОбъектаМодуль	2
#Задать ТипОбъектаФорма		3
#Задать ТипОбъектаТаблица	4

#Задать КартинкаМодуля 		601
#Задать КартинкаФормы  		603
#Задать КартинкаАтрибут		219
#Задать КартинкаТаблицыГр	318
#Задать КартинкаТаблицы		79


//___________________________________________________________________________________________
//Задает в дереве конфигурации собственную картинку объекта
Процедура УстановитьКартинкуОбъекта(Дерево,ИмяОбъекта,КартинкаОбъекта)Экспорт
	Дерево.ВыбратьЭлементы();
	Пока Дерево.ПолучитьЭлемент()=1 Цикл
		Если Дерево.ПолучитьТекст()="Объекты" Тогда
			Дерево.ВыбратьПодчиненныеЭлементы();
			Пока Дерево.ПолучитьЭлемент()=1 Цикл
				Если Дерево.ПолучитьТекст()=ИмяОбъекта Тогда
					Дерево.УстановитьКартинку(,КартинкаОбъекта);
					Прервать;
				КонецЕсли
			КонецЦикла
			Прервать;
		КонецЕсли
	КонецЦикла
КонецПроцедуры//УстановитьКартинкуОбъекта

//___________________________________________________________________________________________
//ТекДерево:ДеревоЗначений
Процедура ЗагрузитьСтруктуруОбъекта(Конт,ТекЭлементДерева)Экспорт
	ТекДерево=Конт.ТекДерево;
	ИмяОбъекта=Конт.ИмяОбъекта;
	КартинкаЭлемента=Конт.КартинкаЭлемента;
	БазовРеквизиты=Конт.БазовРеквизиты; 
	
	Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
	Для А=1 По РазмерСтруктуры(Мета[ИмяОбъекта]) Цикл
		Вид=Мета[ИмяОбъекта].ИдентификаторПоНомеру(А); 
		
		ТекРодитель=ТекДерево.ВставитьЭлемент(Вид,КартинкаЭлемента,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекРодитель,1,0,ТипОбъектаТекст,КартинкаАтрибут);
		
		
		ЗагрузитьСтруктуруВида(Конт,ТекРодитель,Вид);
	КонецЦикла;
	
	УстановитьКартинкуОбъекта(ТекДерево,ИмяОбъекта,КартинкаЭлемента);
КонецПроцедуры

//___________________________________________________________________________________________
//ТекДерево:ДеревоЗначений
Функция ЗагрузитьСтруктуруВида(Конт,ТекЭлементДерева,Вид)Экспорт
	ТекДерево=Конт.ТекДерево;
	ИмяОбъекта=Конт.ИмяОбъекта;
	КартинкаЭлемента=Конт.КартинкаЭлемента;
	БазовРеквизиты=Конт.БазовРеквизиты; 
	РежимОбъекта=Конт.РежимОбъекта;
	
	Если РежимОбъекта["Тип-Форма"]=1 Тогда
		ТекДерево.МетаФорма(ТекЭлементДерева);
	КонецЕсли

	Если РежимОбъекта["Модуль проведения"]=1 Тогда
		ТекЭлемент=ТекДерево.ВставитьЭлемент("Модуль проведения",КартинкаМодуля,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекЭлемент,0,0,ТипОбъектаМодуль);
	КонецЕсли

	Если РежимОбъекта["Форма диалога"]=1 Тогда
		ТекЭлемент=ТекДерево.ВставитьЭлемент("Форма диалога",КартинкаФормы,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекЭлемент,0,0,ТипОбъектаФорма);
	КонецЕсли
	
	Если РежимОбъекта["Форма группы"]=1 Тогда
		ТекЭлемент=ТекДерево.ВставитьЭлемент("Форма группы",604,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекЭлемент,0,0,ТипОбъектаФорма);
	КонецЕсли

	Если РежимОбъекта["Список элементов"]=1 Тогда
		//ТекДерево.УстановитьТипОбъекта(ТекЭлементДерева,1,0,ТипОбъектаТекст,КартинкаФормы);
		ТекЭлемент=ТекДерево.ВставитьЭлемент("Список элементов",602,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекЭлемент,0,0,ТипОбъектаФорма);
	КонецЕсли

	Если РежимОбъекта["Таблицы"]=1 Тогда
		ТекПечФормы=ТекДерево.ВставитьЭлемент("Таблицы",КартинкаТаблицыГр,ТекЭлементДерева);
		ТекДерево.МетаГруппа(ТекПечФормы,1,КартинкаТаблицы);
		ТекДерево.МетаТаблица(ТекПечФормы);
		Если ПустоеЗначение(Вид)=0 Тогда
			Метаданные=СоздатьОбъект("Метаданные").Массив.Метаданные;
			Мета=Метаданные[ИмяОбъекта][Вид]["Таблицы"];
			Для Б=1 По РазмерСтруктуры(Мета) Цикл
				ТекИмя=Мета.ИдентификаторПоНомеру(Б);
				ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,КартинкаТаблицы,ТекПечФормы);
				ТекДерево.МетаТаблица(ТекЭлемент);
				ТекДерево.МетаРедактирование(ТекЭлемент);
			КонецЦикла
		КонецЕсли
	КонецЕсли
	

	Если РежимОбъекта["Измерения"]=1 Тогда
		ТекРеквизиты=ТекДерево.ВставитьЭлемент("Измерения",Конт.КартинкаИзмеренийГр,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекРеквизиты,1,1,ТипОбъектаАтрибут,КартинкаАтрибут);
		
		Если ПустоеЗначение(Вид)=0 Тогда
			Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
			МетаСпр=Мета[ИмяОбъекта][Вид]["Измерения"];
			Для Б=1 По РазмерСтруктуры(МетаСпр) Цикл
				ТекИмя=МетаСпр.ИдентификаторПоНомеру(Б);
				Если БазовРеквизиты.НайтиИдентификатор(ТекИмя)=0 Тогда
					ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,КартинкаАтрибут,ТекРеквизиты);
					ТекДерево.УстановитьТипОбъекта(ТекЭлемент,1,0,ТипОбъектаАтрибут);
				КонецЕсли
			КонецЦикла;
		КонецЕсли
	КонецЕсли
	
	Если РежимОбъекта["Ресурсы"]=1 Тогда
		ТекРеквизиты=ТекДерево.ВставитьЭлемент("Ресурсы",Конт.КартинкаРесурсовГр,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекРеквизиты,1,1,ТипОбъектаАтрибут,КартинкаАтрибут);
		
		Если ПустоеЗначение(Вид)=0 Тогда
			Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
			МетаСпр=Мета[ИмяОбъекта][Вид]["Ресурсы"];
			Для Б=1 По РазмерСтруктуры(МетаСпр) Цикл
				ТекИмя=МетаСпр.ИдентификаторПоНомеру(Б);
				Если БазовРеквизиты.НайтиИдентификатор(ТекИмя)=0 Тогда
					ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,КартинкаАтрибут,ТекРеквизиты);
					ТекДерево.УстановитьТипОбъекта(ТекЭлемент,1,0,ТипОбъектаАтрибут);
				КонецЕсли
			КонецЦикла;
		КонецЕсли
	КонецЕсли

	//РЕВИЗИТЫ
	Если РежимОбъекта["Реквизиты"] Тогда
		НомерКартинки=РежимОбъекта["Реквизиты"];
		
		ТекРеквизиты=ТекДерево.ВставитьЭлемент("Реквизиты",НомерКартинки,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекРеквизиты,1,1,ТипОбъектаАтрибут,КартинкаАтрибут);
	
		//сначала вставляем базовые реквизиты	
		Для Б=1 По РазмерСтруктуры(БазовРеквизиты) Цикл
			ТекИмя=БазовРеквизиты.ИдентификаторПоНомеру(Б);
			ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,215,ТекРеквизиты);
			ТекДерево.УстановитьТипОбъекта(ТекЭлемент,1,0,ТипОбъектаАтрибут);
			ТекДерево.МетаРедактирование(ТекЭлемент,1);
		КонецЦикла
	
		//потом - все остальные	
		Если ПустоеЗначение(Вид)=0 Тогда
			Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
			МетаСпр=Мета[ИмяОбъекта][Вид]["Реквизиты"];
			Для Б=1 По РазмерСтруктуры(МетаСпр) Цикл
				ТекИмя=МетаСпр.ИдентификаторПоНомеру(Б);
				Если БазовРеквизиты.НайтиИдентификатор(ТекИмя)=0 Тогда
					ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,КартинкаАтрибут,ТекРеквизиты);
					ТекДерево.УстановитьТипОбъекта(ТекЭлемент,1,0,ТипОбъектаАтрибут);
				КонецЕсли
			КонецЦикла;
		КонецЕсли
	КонецЕсли

	Если РежимОбъекта["Табличная часть"] Тогда
		НомерКартинки=РежимОбъекта["Табличная часть"];
		ТекРеквизиты=ТекДерево.ВставитьЭлемент("Табличная часть",НомерКартинки,ТекЭлементДерева);
		ТекДерево.УстановитьТипОбъекта(ТекРеквизиты,1,1,ТипОбъектаАтрибут,КартинкаАтрибут);
		
		Если ПустоеЗначение(Вид)=0 Тогда
			Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
			МетаСпр=Мета[ИмяОбъекта][Вид]["Табличная часть"];
			Для Б=1 По РазмерСтруктуры(МетаСпр) Цикл
				ТекИмя=МетаСпр.ИдентификаторПоНомеру(Б);
				ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,КартинкаАтрибут,ТекРеквизиты);
				ТекДерево.УстановитьТипОбъекта(ТекЭлемент,1,0,ТипОбъектаАтрибут);
			КонецЦикла;
		КонецЕсли
	КонецЕсли
	
	Если РежимОбъекта["Реквизиты-Перечисления"]=1 Тогда
		ТекДерево.МетаГруппа(ТекЭлементДерева,1,КартинкаАтрибут);
		Если ПустоеЗначение(Вид)=0 Тогда
			Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
			МетаСпр=Мета[ИмяОбъекта][Вид];
			Для Б=1 По РазмерСтруктуры(МетаСпр) Цикл
				ТекИмя=МетаСпр.ИдентификаторПоНомеру(Б);
				ТекЭлемент=ТекДерево.ВставитьЭлемент(ТекИмя,КартинкаАтрибут,ТекЭлементДерева);
				ТекДерево.УстановитьТипОбъекта(ТекЭлемент,1,0,ТипОбъектаТекст);
			КонецЦикла;
		КонецЕсли
	КонецЕсли

	Если РежимОбъекта["ТолькоЧтение"]=1 Тогда
		ТекДерево.МетаРедактирование(ТекЭлементДерева,0);
	КонецЕсли
	
	ИмяФункции=РежимОбъекта["ПроцедураОбратногоВызова"];
	Если ПустоеЗначение(ИмяФункции)=0 Тогда
		Выражение("Конт."+ИмяФункции+"(ТекЭлементДерева,Вид)");
	КонецЕсли
	

	ТекДерево.Обновить();
	Возврат БазовРеквизиты;
КонецФункции






//___________________________________________________________________________________________
Функция ПолучитьИдентификаторОбъектаМД(Путь)Экспорт
	МетаФайл=СоздатьОбъект("ФайлМетаданных");
	Перем Объект;
	Рез=МетаФайл.ПрочитатьОбъект(Путь+".inf",Объект);
	Если РазмерСтруктуры(Объект)>0 Тогда
		 Возврат Объект.NameDB;
	КонецЕсли
	Возврат "";
КонецФункции//ПолучитьИдентификаторОбъектаМД

//___________________________________________________________________________________________
Функция ПолучитьСинонимОбъектаМД(Путь)Экспорт
	МетаФайл=СоздатьОбъект("ФайлМетаданных");
	Перем Объект;
	Рез=МетаФайл.ПрочитатьОбъект(Путь+".inf",Объект);
	Если РазмерСтруктуры(Объект)>0 Тогда
		 Возврат Объект.Alias;
	КонецЕсли
	Возврат "";
КонецФункции//ПолучитьСинонимОбъектаМД


//___________________________________________________________________________________________
Функция ПолучитьИдентификаторБД(Путь)Экспорт
	Возврат ПолучитьИдентификаторОбъектаМД(Путь);
КонецФункции//ПолучитьИдентификаторБД
