//******************************************************************************************
//Предопределенные процедуры и функции в режиме Предприятия
//******************************************************************************************
Процедура ПриНачалеРаботыСистемы()
	ПодписатьсяНаСобытие("ПослеЗаписиСправочника","ЗаписатьВЖурналДокументов",,10);
	ЖурналДок=СоздатьОбъект("ТаблицаБД");
	ЖурналДок.ДобавитьПоле("ИДДок","Число",20,0);
	ЖурналДок.ДобавитьПоле("ВидДок","Строка",50,0);
	ЖурналДок.ДобавитьПоле("#IsPosted","Строка",1,0);
	ЖурналДок.ДобавитьПоле("НомерДок","Строка",10,0);       
	ЖурналДок.ДобавитьПоле("ДатаДок","Дата",0,0);            
	ЖурналДок.ДобавитьПоле("#ВремяДокумента","Число",9,0);  
	ЖурналДок.ДобавитьПоле("Префикс","Строка",18,0);  
	//ЖурналДок.ДобавитьПоле("Префикс1","Строка",18,0);       
	
	ЖурналДок.НачальнаяИнициализация("ЖурналДокументов","JOURNAL",1,0);
КонецПроцедуры

Процедура ПриЗавершенииРаботыСистемы()

КонецПроцедуры 


//******************************************************************************************
//Предопределенные процедуры и функции в режиме Конфигуратора
//******************************************************************************************
Процедура ПриНачалеРаботыКонфигуратора()

КонецПроцедуры 


Процедура ПриЗавершенииРаботыКонфигуратора()

КонецПроцедуры 

//___________________________________________________________________________________________
Функция ЗаписатьВЖурналДокументов(ФлагЗапрета,нОбъект="")
	Если ТипЗначения(нОбъект)<4 Тогда
		Возврат 0;
	Иначе
		ИД=нОбъект.ПолучитьИдентификаторОбъекта();	
		ТипОбъекта=нОбъект.ПолучитьТипОбъекта();
		ВидОбъекта=нОбъект.Вид();
	КонецЕсли;	
	Если ВРег(Лев(ТипОбъекта,8))<>"ДОКУМЕНТ" Тогда
	    Возврат 0;	
	КонецЕсли;
	ЖурналДок=СоздатьОбъект("ЖурналДокументов");
	ЖурналДок.ОчиститьУсловия();
	ЖурналДок.ДобавитьУсловие("ИДДок",нОбъект.ИД);
	ЖурналДок.ВыбратьЭлементыБД(0,0);
	Если ЖурналДок.ПолучитьЭлемент()=0 Тогда
	    ЖурналДок.Новый();
	КонецЕсли;    
	ЖурналДок.УстановитьАтрибут("ИДДок",нОбъект.ИД);
	ЖурналДок.УстановитьАтрибут("ВидДок",нОбъект.Вид());
	ЖурналДок.УстановитьАтрибут("#IsPosted",нОбъект.ПолучитьАтрибут("#IsPosted"));
	ЖурналДок.УстановитьАтрибут("НомерДок",нОбъект.НомерДок);
	ЖурналДок.УстановитьАтрибут("Префикс",нОбъект.ПрефиксНомера);
	ЖурналДок.УстановитьАтрибут("ДатаДок",нОбъект.ДатаДок);
	ЖурналДок.УстановитьАтрибут("#ВремяДокумента",нОбъект.ВремяДокумента);
	ЖурналДок.УстановитьАтрибут("#IsDel",нОбъект.ПолучитьАтрибут("#IsDel"));
	//TODO: добавить запись граф отбора и общих реквизитов
	ЖурналДок.Записать();
	Возврат 0;
КонецФункции//ЗаписатьВЖурналДокументов
