//Константы для задания периода действия
#Задать ПЕРИОД_НЕ_НАЗНАЧЕН 0
#Задать ПЕРИОД_ГОД 1
#Задать ПЕРИОД_КВАРТАЛ 2
#Задать ПЕРИОД_МЕСЯЦ 3
#Задать ПЕРИОД_ДЕНЬ 4
//Константы для задания типа номера
#Задать ТИП_ЧИСЛО 0
#Задать ТИП_СТРОКА 1
//Константы контроля уникальности
#Задать КОНТРОЛЬ_УНИКАЛЬНОСТИ_ВЫКЛ 0
#Задать КОНТРОЛЬ_УНИКАЛЬНОСТИ_ВКЛ 1
#Задать КОНТРОЛЬ_УНИКАЛЬНОСТИ_В_ПРЕДЕЛАХ_ПОДЧИНЕНИЯ 2

Перем НовыйНомер Экспорт;
//******************************************************************************************
//Атрибуты объекта доступные через точку (переменные с признаком Экспорт)
//******************************************************************************************
//...

//******************************************************************************************
//Предопределенные процедуры и функции объекта
//******************************************************************************************
//Конструктор (вызывается при инициализации объекта)
//ВидОбъекта - вид объекта, задающийся строкой следуемой за символом "."
//Параметр - произвольный параметр (для визуальных элементов в него передается диалоговый элемент формы)
Процедура Конструктор(ВидОбъекта,Параметр)Экспорт
	//Префикс="";
	Инициализация("Нумератор");
КонецПроцедуры
//...

//******************************************************************************************
//Методы объекта (процедуры и функции с признаком Экспорт)
//******************************************************************************************
//...


//___________________________________________________________________________________________
//Функция ПолучитьНовыйНомер(ТипВид)
//	Перем Запрос;
//	
//	УстПрефикс=Префикс;
//	УстТипВид=ТипВид;
//	
//	Запрос=СоздатьОбъект("Запрос");
//	Текст="Номер=Нумератор.Значение;Условие (ТипВид=УстТипВид);Условие (Префикс=УстПрефикс);";
//	Запрос.Выполнить(Текст);
//	
//	Номер=0;
//	Если Запрос.ВыбратьСтроки()=1 Тогда
//		Если Запрос.ПолучитьСтроку()=1 Тогда
//			Номер=Запрос.Номер;
//		КонецЕсли
//	КонецЕсли
//	
//	Если Номер=0 Тогда
//		Новый();
//	КонецЕсли
//	Номер=Число(Номер)+1;
//	
//	УстановитьАтрибут("ТипВид",ТипВид);
//	УстановитьАтрибут("Префикс",Префикс);
//	УстановитьАтрибут("Значение",Номер);
//	Записать();
//	
//	Возврат Префикс+Номер;
//КонецФункции//ПолучитьНовыйНомер
Функция ПроверитьУникальность(ТипВид,Префикс,ДатаНомера,Номер)Экспорт
 	Возврат 1;
КонецФункции
//___________________________________________________________________________________________
Функция ПолучитьНовыйНомерДокумента(ТипВид,Префикс,ДатаНовогоНомера)Экспорт
		
	НачатьТранзакцию();
	    
	ОчиститьУсловия();
	ДобавитьУсловие("ТипВид",ТипВид);
	ДобавитьУсловие("Префикс",Префикс);
	ВыбратьЭлементыБД(0,0);
	Если ПолучитьЭлемент()=1 Тогда
		Период=Число(ПолучитьАтрибут("ПериодДействия"));
		ДатаНомера=ПолучитьАтрибут("ДатаЗначения");
		_КонтрольУникальности=Число(ПолучитьАтрибут("КонтрольУникальности"));
		_Тип=Число(ПолучитьАтрибут("Тип"));
		_ДлинаЗначения=Число(ПолучитьАтрибут("ДлинаЗначения"));
		ФлагПериодичности=1;
		Если Период=ПЕРИОД_НЕ_НАЗНАЧЕН Тогда
		    ФлагПериодичности=0;
		ИначеЕсли Период=ПЕРИОД_ГОД Тогда
		    ДатаНачПериода=НачГода(ДатаНовогоНомера);
		ИначеЕсли Период=ПЕРИОД_КВАРТАЛ Тогда
		    ДатаНачПериода=НачКвартала(ДатаНовогоНомера);
		ИначеЕсли Период=ПЕРИОД_МЕСЯЦ Тогда
		    ДатаНачПериода=НачМесяца(ДатаНовогоНомера);
		ИначеЕсли Период=ПЕРИОД_ДЕНЬ Тогда
		    ДатаНачПериода=ДатаНовогоНомера;
		КонецЕсли;              
		Если ФлагПериодичности=1 Тогда
		    ДобавитьУсловие("ДатаЗначения",ДатаНачПериода);
		    ВыбратьЭлементыБД(0,0);
		    Если ПолучитьЭлемент()=1 Тогда
	            Номер=1+Число(ПолучитьАтрибут("Значение"));
			Иначе
			    Номер=1;
			    Новый();
			    ДатаНачПериода=Дата(0);
			КонецЕсли;    
		Иначе
			Номер=1+Число(ПолучитьАтрибут("Значение"));
		КонецЕсли; 
	Иначе	   
		Номер=1;
		Новый();
		ДатаНачПериода=Дата(0);
		Период=ПЕРИОД_ГОД;
		_КонтрольУникальности=КОНТРОЛЬ_УНИКАЛЬНОСТИ_ВКЛ;
		_Тип=ТИП_ЧИСЛО;
		_ДлинаЗначения=20;	
	КонецЕсли
	Если _КонтрольУникальности>0 Тогда
		Если ПроверкаУникальности(ТипВид,Префикс,Номер,ДатаНачПериода)=0 Тогда
		    Предупреждение("Номер не уникальный!);
		    Возврат 0;
		КонецЕсли;
	КонецЕсли;
	УстановитьАтрибут(",ТипВид,",ТипВид);	
	
	УстановитьАтрибут("Префикс",Префикс);
	УстановитьАтрибут("Значение",Номер);
	УстановитьАтрибут("ПериодДействия",Период);
	УстановитьАтрибут("Тип",_Тип);
	УстановитьАтрибут("КонтрольУникальности",_КонтрольУникальности);
	УстановитьАтрибут("ДлинаЗначения",_ДлинаЗначения);
	УстановитьАтрибут("ДатаЗначения",ДатаНачПериода);
	
	Записать();
	
	ЗафиксироватьТранзакцию();
	Если _Тип=ТИП_СТРОКА Тогда
	    Номер=Прав("0000000000"+Номер,_ДлинаЗначения);
		НовыйНомер=Номер;
	КонецЕсли;	
	Возврат НовыйНомер;
КонецФункции//ПолучитьНовыйНомер
