//******************************************************************************************
Перем глТаблицаТиповНом Экспорт;
Перем глТаблицаТиповСтр Экспорт;
Перем глСписокСтруктурОбъектов Экспорт;

Перем глБылаПроверкаТаблицыМетаданных Экспорт;

Перем БылаРеструктуризация;

//___________________________________________________________________________________________
//ОБСЛУЖИВАНИЕ РЕСТРУКТУРИЗАЦИИ БАЗЫ ДАННЫХ
Процедура глБылаРеструктуризация()Экспорт
	Если БылаРеструктуризация<>1 Тогда
		 Рез=Вопрос("Внимание: произведен первый запуск системы
		 			|в процессе которого будет выполнена реструктуризация 
		 			|базы данных. Продолжить?","Да+Нет+Отмена",100);
		 Если Рез="Да" Тогда
			БылаРеструктуризация=1;
			ЗавершитьРаботуСистемы(1);
			Возврат;
		 КонецЕсли
		 
		 ЗавершитьРаботуСистемы(-1);//немедленный выход
		 Возврат;
	КонецЕсли
КонецПроцедуры//БылаРеструктуризация

Процедура ПриЗавершенииРаботыСистемы()Экспорт
	Если БылаРеструктуризация=1 Тогда
		 Предупреждение("Реструктуризация завершена!
		 				|Для продолжения работы требуется повторный вход.
		 				|Нажмите ОК для автоматического перезапуска системы.",100);
		 				
		 СтрЗапуска="";
		 Для А=1 По КоличествоАргументовПрограммы() Цикл
			 СтрЗапуска=СтрЗапуска+""""+ЗначениеАргументаПрограммы(А)+""" ";
		 КонецЦикла
		 ЗапуститьПриложение(ЗначениеАргументаПрограммы(0),СтрЗапуска);
	КонецЕсли
КонецПроцедуры 

Процедура ПриНачалеРаботыСистемы()
    
КонецПроцедуры 


//******************************************************************************************
//Начальная инициализация модуля - процедура вызывается в режиме Конфигуратора и Предприятия
//******************************************************************************************
Процедура ИнициализацияМодуля()
	//ЗарегистрироватьСобытие("ПриВыборкеЭлементаБД")
	ЗарегистрироватьСобытие("РеструктуризацияДанных")
	
	//Начальная инициализация и установка атрибутов "только чтение"
	Если ConnectionMySQL<>1 Тогда
		ConnectionMySQL=1;
		ConnectionMSSQL=2;
		ConnectionDBF=	3;
		ConnectionSQLLite=6;
		УстановитьТолькоЧтение(ConnectionMySQL,1);
		УстановитьТолькоЧтение(ConnectionDBF,1);
		УстановитьТолькоЧтение(ConnectionMSSQL,1);
		УстановитьТолькоЧтение(ConnectionSQLLite,1);
	КонецЕсли;
	

	//Инициализация таблицы типов	
	//ПроверитьТаблицуМетаданных();
	глТаблицаТиповНом=СоздатьОбъект("Массив");
	глТаблицаТиповСтр=СоздатьОбъект("Структура");
	глСписокСтруктурОбъектов=СоздатьОбъект("Структура");
	БуферОбъектов=СоздатьОбъект("Структура");
КонецПроцедуры//ИнициализацияМодуля

Функция ПриРеструктуризации()
    Возврат 0;
КонецФункции;     
