//Автор:  Alex_Bob 
//E-mail: asbobylk@svsokol.lipetsk.ru
//Версия модуля: 1.01 от 22.07.2004
//Релиз платформы: от 06.07.2004

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при первом открытии формы
Перем СписокИ;

Процедура ПриОткрытии()
    СписокИ=СоздатьОбъект("Интерфейсы");
    ТЗ.НоваяКолонка("Ид",,,,"№",30);
    ТЗ.НоваяКолонка("Наименование",,,,,60);
    СписокИ.ВыбратьЭлементы();
    Пока СписокИ.ПолучитьЭлемент()=1 Цикл
    	ТЗ.НоваяСтрока();
    	ТЗ.ИД=СписокИ.ИД;
    	ТЗ.Наименование=СписокИ.Имя;
    КонецЦикла;
    ТЗ.ТекущаяСтрока(1); 	
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при закрытии формы
Процедура ПриЗакрытии()
//	Если СостояниеКлавиши(27) Тогда
//		СтатусВозврата(0);
//	КонецЕсли;
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Закрыть - выполняет закрытие формы
Процедура ЗакрытьФорму()
	Форма.Закрыть();
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки КнНовый
Процедура НовыйИнтерфейс()
    ИД=0x100000000*СписокИ.НомерТаблицыОбъекта()+Число(ПолучитьЗначениеЗапроса("SELECT max(col1) FROM "+СписокИ.ИмяТаблицыОбъекта()))%0x100000000+1;
    СписокИ.НачатьТранзакцию();
    ИмяИнтерфейса="";
    Если ВвестиСтроку(ИмяИнтерфейса,"Введите наименование интерфейса:",50)=1 Тогда
    	СписокИ.Новый();
    	СписокИ.ИД=ИД;
    	СписокИ.Имя=ИмяИнтерфейса;
    	СписокИ.Записать();
        СписокИ.ЗафиксироватьТранзакцию();
        ТЗ.НоваяСтрока();
    	ТЗ.ИД=СписокИ.ИД;
    	ТЗ.Наименование=СписокИ.Имя;
    	ТЗ.ПолучитьСтрокуПоНомеру(ТЗ.КоличествоСтрок());
    Иначе
        СписокИ.ОтменитьТранзакцию();	 
    КонецЕсли;
  
КонецПроцедуры //НовыйИнтерфейс

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки КнИзменить
Процедура ИзменитьИнтерфейс()
	Если ТЗ.ТекущаяСтрока()=0 Тогда
		Предупреждение("Выберите конкретную строку списка!");
		Возврат; 
	КонецЕсли
	
    ТЗ.ПолучитьСтрокуПоНомеру(ТЗ.ТекущаяСтрока());
    Если СокрЛП(ТЗ.Наименование)="Администратор" Тогда
		Предупреждение("Интерфейс администратора изменить нельзя!");
		Возврат
	КонецЕсли
    ИмяИнтерфейса=ТЗ.Имя;
    Если ВвестиСтроку(ИмяИнтерфейса,"Введите наименование интерфейса:",50)=1 Тогда
    	СписокИ.УстановитьИмяИдентификатора("ИД");
    	СписокИ.УстановитьИдентификаторОбъекта(ТЗ.ИД);
    	СписокИ.НайтиЭлементВБД();
    	СписокИ.Имя=ИмяИнтерфейса;
    	СписокИ.Записать();	 
    КонецЕсли
    
    ТЗ.ИД=СписокИ.ИД;
    ТЗ.Наименование=СписокИ.Имя;
КонецПроцедуры //ИзменитьИнтерфейс

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки КнУдалить
Процедура УдалитьИнтерфейс()
    Если ТЗ.ТекущаяСтрока()=0 Тогда
		Предупреждение("Выберите конкретную строку списка!");
		Возврат; 
	КонецЕсли
	ТЗ.ПолучитьСтрокуПоНомеру(ТЗ.ТекущаяСтрока());
	Если СокрЛП(ТЗ.Наименование)="Администратор" Тогда
		Предупреждение("Интерфейс администратора удалить нельзя!");
		Возврат
	КонецЕсли
	Ответ=Вопрос("Вы действительно хотите удалить интерфейс "+ТЗ.Наименование+"?",4);
	Если Ответ=6 Тогда
		СписокИ.УстановитьИмяИдентификатора("ИД");
		СписокИ.УстановитьИдентификаторОбъекта(ТЗ.ИД);
		СписокИ.Удалить();
		ТЗ.УдалитьСтроку(ТЗ.ТекущаяСтрока()); 
	КонецЕсли
КонецПроцедуры //УдалитьИнтерфейс  

/////////////////////////////////////////////////////////////////////

Функция ПолучитьЗначениеЗапроса(Текст)
	СписокИ.Запрос(Текст);
	Если СписокИ.ПолучитьСтроку()=1 Тогда
		Возврат СписокИ.ПолучитьПоле(1);
	КонецЕсли
	Возврат "";
КонецФункции

Процедура ПоказатьМеню()
    Если ТЗ.ТекущаяСтрока()=0 Тогда
		Предупреждение("Выберите конкретную строку списка!");
		Возврат; 
	КонецЕсли
    Сп=СоздатьОбъект("СписокЗначений");
    ТЗ.ПолучитьСтрокуПоНомеру(ТЗ.ТекущаяСтрока());
    Сп.ДобавитьЗначение(ТЗ.ИД);
    Сп.ДобавитьЗначение(ТЗ.Наименование);
	ОткрытьФормуМодально("Объекты\ГлавноеМеню\Формы\ДеревоМеню",Сп);
КонецПроцедуры //ПоказатьМеню

Процедура ПоказатьПИ()
    Если ТЗ.ТекущаяСтрока()=0 Тогда
		Предупреждение("Выберите конкретную строку списка!");
		Возврат; 
	КонецЕсли
    Сп=СоздатьОбъект("СписокЗначений");
    ТЗ.ПолучитьСтрокуПоНомеру(ТЗ.ТекущаяСтрока());
    Сп.ДобавитьЗначение(ТЗ.ИД);
    Сп.ДобавитьЗначение(ТЗ.Наименование);
	ОткрытьФормуМодально("Объекты\ПанелиИнструментовПользователя\Формы\ДеревоПиктограмм",Сп);
КонецПроцедуры //ПоказатьМеню