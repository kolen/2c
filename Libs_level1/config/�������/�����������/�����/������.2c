Перем Интерфейс;
Перем ГМ;
Перем ТекПозиция;
///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при первом открытии формы
Процедура ПриОткрытии()
	//глВосстановитьЗначенияФормы(Контекст);
    Конт=Форма.Параметр;
    Если ТипЗначенияСтр(Конт)="СписокЗначений" Тогда
    	Интерфейс=Конт.ПолучитьЗначение(1); 
    Иначе
        ЗакрытьФорму();	
    КонецЕсли
    ТекПозиция=0;
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при закрытии формы
Процедура ПриЗакрытии()
//	Если СостояниеКлавиши(27) Тогда
//		СтатусВозврата(0);
//	КонецЕсли;
//	глЗапомнитьЗначенияФормы(Контекст);
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Закрыть - выполняет закрытие формы
Процедура ЗакрытьФорму()
	Форма.Закрыть();
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Выполнить
Процедура ПриНажатииДалее()
    ГМ=СоздатьОбъект("ГлавноеМеню");
    ГМ.УдалитьВсе(Интерфейс);
    Если ВводДанных=1 Тогда
    	ДобавитьМенюВводаДанных(); 
    КонецЕсли;
    Если Администратор=1 Тогда
        ДобавитьМенюАдминистратора();
    КонецЕсли;    
    Если Помощник=1 Тогда
        ДобавитьМенюПомощника();
    КонецЕсли;    
    ЗакрытьФорму();
КонецПроцедуры
//---------------------------------------------------------------------
Процедура ДобавитьМенюВводаДанных()
    
    Мета=СоздатьОбъект("Метаданные").Массив.Метаданные;
    ТекИД=Число(ПолучитьЗначениеЗапроса("SELECT max("+ГМ.ПолучитьИмяПоляБД("ИД")+") FROM "+ГМ.ИмяТаблицыОбъекта()))+1;
    ГМ.НачатьТранзакцию();
    ГМ.Новый();
    ГМ.ИД=ТекИД;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=1;
    ГМ.Родитель=0;
    ГМ.Заголовок="Справочники";
    ГМ.Записать();
    Родитель=ТекИД;
    КолСправочников=РазмерСтруктуры(Мета["Справочник"]);
    Для Сч=1 По КолСправочников Цикл
        Вид=Мета["Справочник"].ИдентификаторПоНомеру(Сч);
    	ГМ.Новый();
    	ГМ.ИД=ТекИД+Сч;
    	ГМ.Заголовок=Вид;
    	ГМ.Интерфейс=Интерфейс;
    	ГМ.Позиция=Сч;
    	ГМ.Родитель=Родитель;
    	ГМ.Объект="Справочник."+Вид;
    	ГМ.Команда="ОткрытьСписок.Справочник."+Вид;
    	ГМ.Записать(); 
    КонецЦикла;
    ТекИД=ТекИД+1+КолСправочников;
    ГМ.Новый();
    ГМ.ИД=ТекИД;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=2;
    ГМ.Родитель=0;
    ГМ.Заголовок="Документы";
    ГМ.Записать();
    Родитель=ТекИД;
    КолДокументов=РазмерСтруктуры(Мета["Документ"]);
    Для Сч=1 По КолДокументов Цикл
        Вид=Мета["Документ"].ИдентификаторПоНомеру(Сч);
    	ГМ.Новый();
    	ГМ.ИД=ТекИД+Сч;
    	ГМ.Заголовок=Вид;
    	ГМ.Интерфейс=Интерфейс;
    	ГМ.Позиция=Сч;
    	ГМ.Родитель=Родитель;
    	ГМ.Объект="Документ."+Вид;
    	ГМ.Команда="ОткрытьСписок.Документ."+Вид;
    	ГМ.Записать(); 
    КонецЦикла;
    ТекИД=ТекИД+1+КолДокументов;
    ГМ.Новый();
    ГМ.ИД=ТекИД;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=3;
    ГМ.Родитель=0;
    ГМ.Заголовок="Отчеты";
    ГМ.Записать();
    Родитель=ТекИД;
    КолОтчетов=РазмерСтруктуры(Мета["Отчет"]);
    Для Сч=1 По КолОтчетов Цикл
        Вид=Мета["Отчет"].ИдентификаторПоНомеру(Сч);
    	ГМ.Новый();
    	ГМ.ИД=ТекИД+Сч;
    	ГМ.Заголовок=Вид;
    	ГМ.Интерфейс=Интерфейс;
    	ГМ.Позиция=Сч;
    	ГМ.Родитель=Родитель;
    	ГМ.Команда="Отчет."+Вид;
    	ГМ.Записать(); 
    КонецЦикла;
    ТекИД=ТекИД+1+КолОтчетов;
    ГМ.Новый();
    ГМ.ИД=ТекИД;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=4;
    ГМ.Родитель=0;
    ГМ.Заголовок="Обработки";
    ГМ.Записать();
    Родитель=ТекИД;
    КолОбработок=РазмерСтруктуры(Мета["Обработка"]);
    Для Сч=1 По КолОбработок Цикл
        Вид=Мета["Обработка"].ИдентификаторПоНомеру(Сч);
    	ГМ.Новый();
    	ГМ.ИД=ТекИД+Сч;
    	ГМ.Заголовок=Вид;
    	ГМ.Интерфейс=Интерфейс;
    	ГМ.Позиция=Сч;
    	ГМ.Родитель=Родитель;
    	ГМ.Команда="Обработка."+Вид;
    	ГМ.Записать(); 
    КонецЦикла;
    ГМ.ЗафиксироватьТранзакцию();
    ТекПозиция=4;
КонецПроцедуры//ДобавитьМенюВводаДанных

//---------------------------------------------------------------------
Процедура ДобавитьМенюАдминистратора()
    ГМ.НачатьТранзакцию();
    ГМ.Новый();
    ТекИД=Число(ПолучитьЗначениеЗапроса("SELECT max("+ГМ.ПолучитьИмяПоляБД("ИД")+") FROM "+ГМ.ИмяТаблицыОбъекта()))+1;
    ГМ.ИД=ТекИД;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=ТекПозиция+1;
    ГМ.Родитель=0;
    ГМ.Заголовок="Администрирование";
    ГМ.Записать();
    Родитель=ТекИД;
    ГМ.Новый();
    ГМ.ИД=ТекИД+1;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=1;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="Подключение к БД";
    ГМ.Команда="Объекты\БазаДанныхЛокально\Формы\Параметры подключения";
    ГМ.Параметр=ЗначениеВСтроку(0);
    ГМ.Модальность=1;
    ГМ.Записать();
    ГМ.Новый();
    ГМ.ИД=ТекИД+2;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=2;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="SQL-сервис";
    ГМ.Команда="Общие формы\SQL-Сервис";
    ГМ.Записать();
    ГМ.Новый();
    ГМ.ИД=ТекИД+3;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=3;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="";
    ГМ.Команда="";
    ГМ.Записать();
    ГМ.Новый();
    ГМ.ИД=ТекИД+4;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=4;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="Наборы прав";
    ГМ.Команда="Объекты\НаборыПрав\Формы\СписокНаборовПрав";
    ГМ.Записать();
    ГМ.Новый();
    ГМ.ИД=ТекИД+5;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=5;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="Пользователи";
    ГМ.Команда="Объекты\Пользователи\Формы\СписокПользователей";
    ГМ.Записать();
    ГМ.Новый();
    ГМ.ИД=ТекИД+6;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=6;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="Интерфейсы";
    ГМ.Команда="Объекты\Интерфейсы\Формы\СписокИнтерфейсов";
    ГМ.Записать();
    ГМ.ЗафиксироватьТранзакцию();
    ТекПозиция=ТекПозиция+1;

КонецПроцедуры//ДобавитьМенюАдминистратора

//---------------------------------------------------------------------
Процедура ДобавитьМенюПомощника()
    ГМ.НачатьТранзакцию();
    ГМ.Новый();
    ТекИД=Число(ПолучитьЗначениеЗапроса("SELECT max("+ГМ.ПолучитьИмяПоляБД("ИД")+") FROM "+ГМ.ИмяТаблицыОбъекта()))+1;
    ГМ.ИД=ТекИД;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=ТекПозиция+1;
    ГМ.Родитель=0;
    ГМ.Заголовок="Синтаксис-помощник";
    ГМ.Записать();
    Родитель=ТекИД;
    ГМ.Новый();
    ГМ.ИД=ТекИД+1;
    ГМ.Интерфейс=Интерфейс;
    ГМ.Позиция=1;
    ГМ.Родитель=Родитель;
    ГМ.Заголовок="Синтаксис-помощник";
    ГМ.Команда="Общие формы\Синтаксис-помощник\Синтаксис-помощник";
    ГМ.Записать();
    ГМ.ЗафиксироватьТранзакцию();
    ТекПозиция=ТекПозиция+1;

КонецПроцедуры//ДобавитьМенюПомощника

//---------------------------------------------------------------------
Функция ПолучитьЗначениеЗапроса(Текст)
	ГМ.Запрос(Текст);
	Если ГМ.ПолучитьСтроку()=1 Тогда
		Возврат ГМ.ПолучитьПоле(1);
	КонецЕсли
	Возврат "";
КонецФункции//ПолучитьЗначениеЗапроса
