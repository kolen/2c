//Автор:  Alex_Bob 
//E-mail: asbobylk@svsokol.lipetsk.ru
//Версия модуля: 1.00 от 29.06.2004
//Релиз платформы: позже 09.06.2004

//******************************************************************************************
//Атрибуты объекта доступные через точку (переменные с признаком Экспорт)
//******************************************************************************************
//...
Перем ИмяТаблицыОбъекта Экспорт;
//******************************************************************************************
//Внутренние переменные
//******************************************************************************************
//...

//******************************************************************************************
//Предопределенные процедуры и функции объекта
//******************************************************************************************

//___________________________________________________________________________________________
//Динамическое получение атрибутов
Функция ПолучитьАтрибут(Имя) Экспорт
    Возврат БазовыйОбъект.ПолучитьАтрибут(Имя);
КонецФункции

//___________________________________________________________________________________________
//Динамическое задание атрибутов
Процедура УстановитьАтрибут(Имя,Значение) Экспорт
    БазовыйОбъект.УстановитьАтрибут(Имя,Значение);
КонецПроцедуры

//___________________________________________________________________________________________
Функция ПолучитьИмяАтрибута(Номер) Экспорт
	Возврат БазовыйОбъект.ПолучитьИмяАтрибута(Номер);
КонецФункции
//___________________________________________________________________________________________
Функция ПолучитьКоличествоАтрибутов() Экспорт
    Возврат БазовыйОбъект.ПолучитьКоличествоАтрибутов();
КонецФункции
//___________________________________________________________________________________________
//Установка внутреннего идентификатора (номера в БД) объекта 
//(или условное позиционирование объекта)
Процедура УстановитьИдентификаторОбъекта(НовИдентификатор)Экспорт
    БазовыйОбъект.УстановитьИдентификаторОбъекта(НовИдентификатор);
КонецПроцедуры

//___________________________________________________________________________________________
//Получение внутреннего идентификатора объекта 
Функция ПолучитьИдентификаторОбъекта() Экспорт
    Возврат БазовыйОбъект.ПолучитьИдентификаторОбъекта();
КонецФункции

//___________________________________________________________________________________________
//Строковое представление объекта
Функция ПолучитьПредставлениеОбъекта() Экспорт

КонецФункции
//___________________________________________________________________________________________
//Признак не пустого значения
Функция Выбран()Экспорт
	Возврат 1;
КонецФункции
//___________________________________________________________________________________________
//Строковое значение типа объекта
Функция ПолучитьТипОбъекта()Экспорт
	 Возврат "ПраваДоступа";
КонецФункции

//___________________________________________________________________________________________
//Конструктор (вызывается при инициализации объекта)
//ВидОбъекта - вид объекта, задающийся строкой следуемой за символом "."
//Параметр - произвольный параметр (для визуальных элементов - объект базового класса)
Процедура Конструктор(ВидОбъекта,Параметр) Экспорт
    Если БылаИнициализация<>1 Тогда
		 НачальнаяИнициализация();
	КонецЕсли;
	Инициализация(ПолучитьТипОбъекта());
	ИмяТаблицыОбъекта="rights";
КонецПроцедуры

//___________________________________________________________________________________________
//Деструктор (вызывается при удалении объекта)
//Процедура Деструктор()Экспорт
//
//КонецПроцедуры




//___________________________________________________________________________________________
//Обрабочик событий визуального объекта
//Возвращает:
//0 - событие не обработано (передается в форму для дальнейшей обработки)
//1 - событие обработано (далее в форму не передается)
//ИмяСобытия - имя события как оно задано в окне свойств конфигуратора
Функция ОбработкаСобытия(ИмяСобытия) Экспорт

	Возврат 0;
КонецФункции
//___________________________________________________________________________________________
//Открытие стандартной формы редактирования объекта
Функция ОткрытьФормуОбъекта(Парам1,Парам2) Экспорт
	Возврат 0;//0 - форма отсутствует
КонецФункции
//___________________________________________________________________________________________
//Вызывается при открытии любой подчиненной формы
Процедура ОбработкаОткрытияФормы(Конт) Экспорт

КонецПроцедуры

//___________________________________________________________________________________________
//Вызывается при закрытии любой подчиненной формы
Процедура ОбработкаЗакрытияФормы(Конт,НомерВызова) Экспорт

КонецПроцедуры

//___________________________________________________________________________________________
//Вызывается при попытке присвоить значение диалоговому элементу или запрещенной для записи переменной
Процедура УстановитьЗначение(Значение) Экспорт

КонецПроцедуры

//___________________________________________________________________________________________
//Возвращает текущий вид объекта (вызывается при выгрузке значения в строку)
Функция Вид() Экспорт
	Возврат "";
КонецФункции
//******************************************************************************************
//Методы объекта доступные через точку (процедуры и функции с признаком Экспорт)
//******************************************************************************************

//-------------------------------------------
Функция Записать() Экспорт Виртуально//Записать() - запись элемента в базу данных
	Возврат БазовыйОбъект.Записать();
КонецФункции
//-------------------------------------------
Функция Новый() Экспорт Виртуально 
    Возврат БазовыйОбъект.Новый();
КонецФункции
//-------------------------------------------
Функция ПравоДоступаВсе(НП) Экспорт
    ПолеИД=ПолучитьИмяПоляБД("ИД");
    ПолеНП=ПолучитьИмяПоляБД("НаборПрав");
    ПолеВП=ПолучитьИмяПоляБД("ТипПрава");
    ИмяТаблицы=ИмяТаблицыОбъекта("ИД"); 
    ТекстЗапроса="SELECT "+ПолеИД+" FROM "+ИмяТаблицы+" WHERE "+ПолеНП+"="+Строка(НП)+" AND "+ПолеВП+"='all';";
    Запрос(ТекстЗапроса);
    Если ПолучитьСтроку()=1 Тогда
        Возврат 1;
	Иначе
	    Возврат 0;	
	КонецЕсли
КонецФункции 
//-------------------------------------------
Функция ПравоДоступаАдм(НП) Экспорт
	Если ПравоДоступаВсе(НП)=1 Тогда
		Возврат 1 
	Иначе
		ПолеИД=ПолучитьИмяПоляБД("ИД");
		ПолеНП=ПолучитьИмяПоляБД("НаборПрав");
		ПолеВП=ПолучитьИмяПоляБД("ТипПрава");
		ИмяТаблицы=ИмяТаблицыОбъекта("ИД"); 
		ТекстЗапроса="SELECT "+ПолеИД+" FROM "+ИмяТаблицы+" WHERE "+ПолеНП+"="+Строка(НП)+" AND "+ПолеВП+"='adm';";
		Запрос(ТекстЗапроса);
		Если ПолучитьСтроку()=1 Тогда
			Возврат 1;
		Иначе
			Возврат 0;	
		КонецЕсли
	КонецЕсли
	
	
КонецФункции 
//-------------------------------------------
Функция ПравоДоступаВнешние(НП) Экспорт
    Если ПравоДоступаВсе(НП)=1 Тогда
		Возврат 1 
	Иначе
		ПолеИД=ПолучитьИмяПоляБД("ИД");
		ПолеНП=ПолучитьИмяПоляБД("НаборПрав");
		ПолеВП=ПолучитьИмяПоляБД("ТипПрава");
		ИмяТаблицы=ИмяТаблицыОбъекта("ИД"); 
		ТекстЗапроса="SELECT "+ПолеИД+" FROM "+ИмяТаблицы+" WHERE "+ПолеНП+"="+Строка(НП)+" AND "+ПолеВП+"='ext';";
		Запрос(ТекстЗапроса);
		Если ПолучитьСтроку()=1 Тогда
			Возврат 1;
		Иначе
			Возврат 0;	
		КонецЕсли
	КонецЕсли
	
КонецФункции 
//-------------------------------------------
Функция ПравоДоступаФорма(НП,ВидДоступа,ИмяФормы) Экспорт
	Если ПравоДоступаВсе(НП)=1 Тогда
		Возврат 1; 
	Иначе
		ПолеИД=ПолучитьИмяПоляБД("ИД");
		ПолеНП=ПолучитьИмяПоляБД("НаборПрав");
		ПолеВП=ПолучитьИмяПоляБД("ТипПрава");
		ПолеИФ=ПолучитьИмяПоляБД("Форма");
		ИмяТаблицы=ИмяТаблицыОбъекта("ИД"); 
		ТекстЗапроса="SELECT "+ПолеИД+" FROM "+ИмяТаблицы+" WHERE ("+ПолеНП+"="+Строка(НП)+") AND ("+ПолеВП+"='"+ВидДоступа+"') AND ("+ПолеИФ+"='"+ИмяФормы+"');";
		Запрос(ТекстЗапроса);
		Если ПолучитьСтроку()=1 Тогда
			Возврат 1;
		Иначе
			Возврат 0;	
		КонецЕсли
	КонецЕсли
КонецФункции 
//-------------------------------------------
Функция ПравоДоступаОбъект(НП,ВидДоступа,Объект) Экспорт
	Если ПравоДоступаВсе(НП)=1 Тогда
		Возврат 1; 
	Иначе
		ПолеИД=ПолучитьИмяПоляБД("ИД");
		ПолеНП=ПолучитьИмяПоляБД("НаборПрав");
		ПолеВП=ПолучитьИмяПоляБД("ТипПрава");
		ПолеИО=ПолучитьИмяПоляБД("ОбъектМетаданных");
		ИмяТаблицы=ИмяТаблицыОбъекта("ИД"); 
		ТекстЗапроса="SELECT "+ПолеИД+" FROM "+ИмяТаблицы+" WHERE ("+ПолеНП+"="+Строка(НП)+") AND ("+ПолеВП+"='"+ВидДоступа+"') AND ("+ПолеИО+"="+Строка(Объект)+");";
		Запрос(ТекстЗапроса);
		Если ПолучитьСтроку()=1 Тогда
			Возврат 1;
		Иначе
			Возврат 0;	
		КонецЕсли
	КонецЕсли
КонецФункции 
//******************************************************************************************
//Внутренние процедуры и функции
//******************************************************************************************
//___________________________________________________________________________________________
//Выполняет запрос и возвращает значение из первой колонки первой строки
Функция ПолучитьЗначениеЗапроса(Текст)
	Запрос(Текст);
	Если ПолучитьСтроку()=1 Тогда
		Возврат ПолучитьПоле(1);
	КонецЕсли
	Возврат "";
КонецФункции
//___________________________________________________________________________________________
Функция ПолучитьНовыйИД() Экспорт
	Возврат 0x100000000*НомерТаблицыОбъекта()+
	    Число(ПолучитьЗначениеЗапроса("SELECT max("+ПолучитьИмяПоляБД("ИД")+") FROM "+ИмяТаблицыОбъекта("ИД")))%0x100000000+1;  
КонецФункции//ПолучитьНовыйИД

//___________________________________________________________________________________________
Процедура УдалитьВсеПрава(НаборПрав) Экспорт
	Запрос("DELETE FROM "+ИмяТаблицыОбъекта("ИД")+" WHERE "+ПолучитьИмяПоляБД("НаборПрав")+"="+НаборПрав);  
КонецПроцедуры//УдалитьВсеПрава

Функция ВыбратьЭлементы() Экспорт 
	Возврат БазовыйОбъект.ВыбратьЭлементыБД();
КонецФункции
