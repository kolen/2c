Перем ТекДерево;//ТекДерево:ДеревоЗначений
Перем ИмяОбъекта;
Перем РежимОбъекта;
Перем БазовРеквизиты;
Перем КартинкаЭлемента;
Перем КартинкаЭлементаГр;

//******************************************************************************************
//Предопределенные процедуры и функции в режиме Конфигуратора
//******************************************************************************************
Процедура ПриНачалеРаботыКонфигуратора()
	КартинкаЭлементаГр	=85;
	КартинкаЭлемента	=226;
	ИмяОбъекта="Справочник";
	//РежимОбъекта["Список элементов"]=1;
	//РежимОбъекта["Форма диалога"]=1;
	//РежимОбъекта["Форма группы"]=1;
	//РежимОбъекта["Таблицы"]=1;
	//РежимОбъекта["Реквизиты"]=213;
	РежимОбъекта["ТолькоЧтение"]=1;
	РежимОбъекта["ПроцедураОбратногоВызова"]="ЗаполнитьПараметры";

	БазовРеквизиты=СоздатьОбъект("Структура");
	БазовРеквизиты.Владелец=1;
	БазовРеквизиты.Родитель=1;
	БазовРеквизиты.Код=1;
	БазовРеквизиты.Наименование=1;
КонецПроцедуры 

//___________________________________________________________________________________________
//Процедура вызывается при открытии дерева метаданных
//Здесь долен быть прописан код по заполнению элементов дерева объекта
//Дерево - объект типа ДеревоЗначений
//ПапкаМетаданных - элемент дерева, который является родителем для данного объекта
//Дерево:ДеревоЗначений
Процедура ПриЗагрузкеКонфигурации(Дерево,ПапкаМетаданных)
    ТекДерево=Дерево;
    
	ТекЭлементДерева=Дерево.ВставитьЭлемент("Виртуальный справочник",КартинкаЭлементаГр,ПапкаМетаданных);
	ТекДерево.УстановитьТипОбъекта(ТекЭлементДерева,0,0);//,"ВводНовогоВида",КартинкаЭлемента,1);
    
	ЗагрузитьСтруктуруОбъекта(Контекст,ТекЭлементДерева);
КонецПроцедуры

//___________________________________________________________________________________________
//создает список реальных справочников
Функция ПолучитьСписокСправочников(ТекЭлементДерева)
	Спис=СоздатьОбъект("СписокЗначений");
	ТекДерево.ВыбратьПодчиненныеЭлементы(ТекДерево.ПолучитьРодителя(ТекЭлементДерева));
	Пока ТекДерево.ПолучитьЭлемент()=1 Цикл
		Стр=ТекДерево.ПолучитьТекст();
		Если ВРЕГ(Стр)="СПРАВОЧНИК" Тогда
			ТекДерево.ВыбратьПодчиненныеЭлементы(ТекДерево.ТекущийЭлемент());
			Пока ТекДерево.ПолучитьЭлемент()=1 Цикл
				Стр=ТекДерево.ПолучитьТекст();
				Спис.ДобавитьЗначение(Стр);
			КонецЦикла
			Прервать;
		КонецЕсли
	КонецЦикла
	Возврат Спис;
КонецФункции//ПолучитьСписокСправочников

//___________________________________________________________________________________________
Процедура ВводНовогоВида()
	ТекЭлементДерева=ТекДерево.ВыделенныйЭлемент();
	Если ТекДерево.ЭтоГруппа(ТекЭлементДерева)=1 Тогда
		Возврат;
	КонецЕсли

	Спис=ПолучитьСписокСправочников(ТекДерево.ПолучитьРодителя(ТекЭлементДерева));
	
	//отнимаем список уже созданных виртуальных справочников	
	ТекДерево.ВыбратьПодчиненныеЭлементы(ТекДерево.ПолучитьРодителя(ТекЭлементДерева));
	Пока ТекДерево.ПолучитьЭлемент()=1 Цикл
		Стр=ТекДерево.ПолучитьТекст();
		Рез=Спис.НайтиЗначение(Стр);
		Если Рез>0 Тогда
			 Спис.УдалитьЗначение(Рез);
		КонецЕсли
	КонецЦикла
	
	
	Имя="";
	Рез=Спис.ВыбратьЗначение(Имя,"Выберите существ-й справочник",,,1);
	
	Если Рез=1 Тогда
		ЗагрузитьСтруктуруВида(Контекст,ТекЭлементДерева,"");
		ТекДерево.УстановитьТекст(ТекЭлементДерева,Имя);
	Иначе
		ТекДерево.УдалитьЭлемент(ТекЭлементДерева);
	КонецЕсли
КонецПроцедуры//ВводНовогоВида

//___________________________________________________________________________________________
Процедура ЗаполнитьПараметры(ТекЭлементДерева,Вид)Экспорт
	//Сообщить(Вид);
	ТекЭлемент=ТекДерево.ВставитьЭлемент("Модуль условия",КартинкаМодуля,ТекЭлементДерева);
	ТекДерево.УстановитьТипОбъекта(ТекЭлемент,0,0,ТипОбъектаМодуль);
КонецПроцедуры//ЗаполнитьПараметры
