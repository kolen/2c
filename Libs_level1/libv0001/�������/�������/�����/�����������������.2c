///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при первом открытии формы
Процедура ПриОткрытии()
	//глВосстановитьЗначенияФормы(Контекст);
	
	МассивПараметров=Форма.Параметр;
	
	ТекВид=МассивПараметров[1];
	ТекДок=МассивПараметров[2];
	
	
	Если ТипЗначенияСтр(ТекДок)="Документ" Тогда
		Попытка
		Рег=СоздатьОбъект("Регистр."+ТекВид);
		Исключение
			Сообщить(ОписаниеОшибки());
			СтатусВозврата(0);
			Возврат;
		КонецПопытки
		
		Форма.Заголовок("Движения регистра: "+Рег.Вид());
		
		КоличествоАтрибутов=Рег.ПолучитьКоличествоАтрибутов();
		Таблица.КоличествоФиксКолонок(1);
		Таблица.КоличествоКолонок(1+Рег.ПолучитьКоличествоАтрибутов());
		Ном=1;
		Таблица.КоличествоФиксСтрок(Ном);
		Таблица.КоличествоСтрок(Ном);


		СписокРеквизитов=СоздатьОбъект("Массив");
		Таблица.ИдентификаторКолонки(0,"#Тип");
		Кол=0;
		Для А=1 По Рег.ПолучитьКоличествоАтрибутов() Цикл
			ИмяАтрибута=Рег.ПолучитьИмяАтрибута(А);
			Если Лев(ИмяАтрибута,1)="#" Тогда
				Продолжить;
			КонецЕсли
			
			Кол=Кол+1;
			СписокРеквизитов[Кол]=ИмяАтрибута;
			Таблица.ИдентификаторКолонки(Кол,ИмяАтрибута);
			Таблица.ЗаголовокКолонки(Кол,ИмяАтрибута)
			Таблица.ТипКолонки(ИмяАтрибута,Рег.ПолучитьТипПоля(ИмяАтрибута));
		КонецЦикла;

		КоличествоКолонок=РазмерМассива(СписокРеквизитов);
		Таблица.КоличествоКолонок(1+КоличествоКолонок);
		
		
		Рег.ВыбратьДвиженияДокумента(ТекДок);
		Пока Рег.ПолучитьДвижение() Цикл
			Таблица.КоличествоСтрок(Ном+1);
			Если Рег.Приход Тогда
				Таблица.Картинка(Ном,0,613);
			ИначеЕсли Рег.Расход Тогда
				Таблица.Картинка(Ном,0,614);
			КонецЕсли
			Для А=1 По КоличествоКолонок Цикл
				ИмяАтрибута=СписокРеквизитов[А];
				ЗначениеАтрибута=Рег.ПолучитьАтрибут(ИмяАтрибута);
				//Сообщить("ЗначениеАтрибута="+ЗначениеАтрибута);
				Таблица.Значение(Ном,А,ЗначениеАтрибута);
			КонецЦикла;
			Ном=Ном+1;
		КонецЦикла
		//ТабличнаяЧасть.Инициализация("Регистр.ОстаткиТоваров");
	КонецЕсли
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при закрытии формы
Процедура ПриЗакрытии()
//	Если СостояниеКлавиши(27) Тогда
//		СтатусВозврата(0);
//	КонецЕсли;
//	глЗапомнитьЗначенияФормы(Контекст);
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при повторном открытии формы
Процедура ПриПовторномОткрытии()
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при начале выбора значения
Процедура ПриНачалеВыбораЗначения(Идентификатор,ФлагСтандартнойОбработки)
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при окончании выбора значения
Процедура ОбработкаВыбораЗначения(Значение,Идентификатор,ФлагСтандартнойОбработки)
КонецПроцедуры


///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Закрыть - выполняет закрытие формы
Процедура ЗакрытьФорму()
	Форма.Закрыть();
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Выполнить
Процедура Выполнить()

КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Обработка события объекта Таблица
Процедура ТаблицаДвойнЛевКнопка()
	Стр=Таблица.ТекущаяСтрока();
	Кол=Таблица.ТекущаяКолонка();
	Значение=Таблица.Значение(Стр,Кол);
	Попытка
		
		//Объект=СоздатьОбъект(ТипЗначенияСтр(Значение)+"."+Значение.Вид());
		Объект=ЗначениеИзСтроки(ЗначениеВСтроку(Значение));
		Объект.ОткрытьФормуОбъекта();
	Исключение
	КонецПопытки
	
КонецПроцедуры//ТаблицаДвойнЛевКнопка
